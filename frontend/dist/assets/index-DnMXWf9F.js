(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function k(t,e,n,o){return window.go.backend.App.AddTask(t,e,n,o)}function L(t){return window.go.backend.App.DeleteTask(t)}function I(t,e,n,o){return window.go.backend.App.GetCombinedFilteredTasks(t,e,n,o)}function B(){return window.go.backend.App.GetTasks()}function $(t){return window.go.backend.App.ToggleTask(t)}let l=[],c={status:"all",date:"all",sort:"",ascending:!1},u=null;document.addEventListener("DOMContentLoaded",async()=>{await p(),D(),v()});function D(){const t=document.getElementById("add-btn"),e=document.getElementById("todo-title");t.addEventListener("click",w),e.addEventListener("keypress",d=>{d.key==="Enter"&&w()});const n=document.getElementById("status-filter"),o=document.getElementById("date-filter"),s=document.getElementById("sort-filter"),r=document.getElementById("sort-order");n.addEventListener("change",d=>{c.status=d.target.value,m()}),o.addEventListener("change",d=>{c.date=d.target.value,m()}),s.addEventListener("change",d=>{c.sort=d.target.value,m()}),r.addEventListener("click",()=>{c.ascending=!c.ascending,r.classList.toggle("ascending",c.ascending),r.textContent=c.ascending?"‚Üë":"‚Üì",m()});const i=document.getElementById("delete-modal"),f=document.getElementById("confirm-delete"),g=document.getElementById("cancel-delete");f.addEventListener("click",async()=>{u&&(await b(u),u=null),y()}),g.addEventListener("click",()=>{u=null,y()}),i.addEventListener("click",d=>{d.target===i&&(u=null,y())})}async function p(){try{l=await B(),T(),v()}catch(t){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:",t),a("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞—á–∏","error")}}async function m(){try{l=await I(c.status,c.date,c.sort,c.ascending),T(),v()}catch(t){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤:",t),a("–û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á","error")}}function T(){const t=document.getElementById("todo-list");if(l.length===0){t.innerHTML='<div class="empty-message">–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';return}t.innerHTML=l.map(e=>{const n=e.due_date?new Date(e.due_date):null,o=new Date(e.created_at),r=n&&n<new Date&&!e.completed;return`
            <div class="todo-item ${e.completed?"completed":""} priority-${e.priority}" data-id="${e.id}">
                <div class="todo-content">
                    <input type="checkbox" ${e.completed?"checked":""} 
                           onchange="toggleTodo(${e.id})">
                    <div class="todo-text">
                        <h3>${h(e.title)}</h3>
                        ${e.description?`<p>${h(e.description)}</p>`:""}
                        <div class="todo-meta">
                            <span class="priority priority-${e.priority}">
                                ${C(e.priority)}
                            </span>
                            ${n?`
                                <span class="due-date ${r?"overdue":""}">
                                    ${r?"‚ö†Ô∏è ":"üìÖ "}${E(n)}
                                </span>
                            `:""}
                            <span class="created-date">
                                –°–æ–∑–¥–∞–Ω–æ: ${E(o,!1)}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="todo-actions">
                    <button class="delete-btn" onclick="showDeleteModal(${e.id})">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
        `}).join("")}async function w(){const t=document.getElementById("todo-title"),e=document.getElementById("todo-description"),n=document.getElementById("todo-priority"),o=document.getElementById("todo-duedate"),s=t.value.trim(),r=e.value.trim(),i=n.value,f=o.value;if(!s){a("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏","error"),t.focus();return}try{await k(s,r,i,f),t.value="",e.value="",n.value="medium",o.value="",await p(),a("–ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞","success")}catch(g){console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:",g),a("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É","error")}}window.toggleTodo=async function(t){try{await $(t),await p();const n=l.find(o=>o.id===t)?.completed?"–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞":"–ó–∞–¥–∞—á–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ";a(n,"success")}catch(e){console.error("–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:",e),a("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏","error")}};window.showDeleteModal=function(t){u=t,document.getElementById("delete-modal").classList.add("show")};function y(){document.getElementById("delete-modal").classList.remove("show")}async function b(t){try{await L(t),await p(),a("–ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞","success")}catch(e){console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:",e),a("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É","error")}}function v(){const t=document.getElementById("total-tasks"),e=document.getElementById("active-tasks"),n=document.getElementById("completed-tasks"),o=l.length,s=l.filter(i=>!i.completed).length,r=l.filter(i=>i.completed).length;t.textContent=`–í—Å–µ–≥–æ: ${o}`,e.textContent=`–ê–∫—Ç–∏–≤–Ω—ã—Ö: ${s}`,n.textContent=`–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö: ${r}`}function h(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}function C(t){return{low:"–ù–∏–∑–∫–∏–π",medium:"–°—Ä–µ–¥–Ω–∏–π",high:"–í—ã—Å–æ–∫–∏–π"}[t]||"–°—Ä–µ–¥–Ω–∏–π"}function E(t,e=!0){if(!t)return"";const n={year:"numeric",month:"short",day:"numeric"};return e&&(n.hour="2-digit",n.minute="2-digit"),new Intl.DateTimeFormat("ru-RU",n).format(t)}function a(t,e){const n=document.querySelector(".notification");n&&n.remove();const o=document.createElement("div");o.className=`notification ${e}`,o.textContent=t,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},10),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{o.parentNode&&o.remove()},300)},4e3)}
